<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{layout :: layout('Rewards', ~{::section})}">
<section class="space-y-8" th:attr="data-current-points=${account != null ? account.currentPoints : 0}">
    <div class="grid gap-6 lg:grid-cols-[2fr,1fr]">
        <div class="card p-6 reveal">
            <div class="text-sm uppercase tracking-[0.2em] text-ink/60">Rewards</div>
            <div class="font-display text-2xl">Redeem Your Points</div>
            <p class="mt-2 text-sm text-ink/60">Redeem available rewards from your restaurant.</p>
        </div>
        <div class="card p-6 reveal">
            <div class="text-sm uppercase tracking-[0.2em] text-ink/60">Current Points</div>
            <div class="points-big" th:text="${account != null ? account.currentPoints : 0}">0</div>
            <form class="mt-4 flex gap-3 items-end" th:action="@{/customer/rewards}" method="get" data-loading>
                <div class="flex flex-col gap-2">
                    <label class="text-xs uppercase tracking-[0.2em] text-ink/60" for="accountId">Account</label>
                    <select class="input" id="accountId" name="accountId">
                        <option th:each="acc : ${accounts}"
                                th:value="${acc.id}"
                                th:selected="${acc.id == accountId}"
                                th:text="${acc.accountNumber}">
                            ACCT
                        </option>
                    </select>
                </div>
                <button class="btn-secondary" type="submit">Load</button>
            </form>
        </div>
    </div>

    <div th:if="${errorMessage != null}" class="card p-4 border border-red-200 bg-red-50 text-red-900 reveal">
        <div class="font-semibold">Error</div>
        <div class="text-sm" th:text="${errorMessage}">Message</div>
    </div>

    <div class="grid gap-6 md:grid-cols-2" th:if="${rewardCards != null and !#lists.isEmpty(rewardCards)}">
        <div class="card p-6 reveal" th:each="card, iter : ${rewardCards}" data-reward-card>
            <div class="flex items-center justify-between">
                <div>
                    <div class="text-sm uppercase tracking-[0.2em] text-ink/60">Reward</div>
                    <div class="font-display text-xl" th:text="${card.name}">Reward</div>
                </div>
                <div class="stat-pill" th:text="${card.costPoints + ' pts'}">0 pts</div>
            </div>
            <p class="mt-2 text-sm text-ink/60" th:text="${card.description}">Description</p>

            <form class="mt-6 space-y-3" th:action="@{/customer/rewards/redeem}" method="post" data-loading>
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                <input type="hidden" name="accountId" th:value="${accountId}">
                <input type="hidden" name="rewardId" th:value="${card.rewardId}">

                <div class="flex flex-col gap-2">
                    <label class="text-xs uppercase tracking-[0.2em] text-ink/60"
                           th:for="'notes-' + ${iter.index}">Notes</label>
                    <input class="input" name="notes" type="text" placeholder="Optional note"
                           th:id="'notes-' + ${iter.index}">
                </div>

                <button class="btn-primary w-full"
                        type="submit"
                        th:disabled="${account == null or account.currentPoints < card.costPoints}">
                    Redeem Reward
                </button>
            </form>
        </div>
    </div>
    <div class="card p-6 text-sm text-ink/60 reveal"
         th:if="${rewardCards == null or #lists.isEmpty(rewardCards)}">
        No rewards available for this restaurant.
    </div>
</section>
</html>
