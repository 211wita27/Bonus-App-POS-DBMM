<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{layout :: layout('Dashboard', ~{::section})}">
<section class="space-y-8">
    <div class="grid gap-6 lg:grid-cols-[2fr,1fr]">
        <div class="card p-6 reveal">
            <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
                <div>
                    <div class="text-sm uppercase tracking-[0.2em] text-ink/60">Account</div>
                    <div class="font-display text-2xl">Customer Dashboard</div>
                </div>
                <form class="flex flex-wrap gap-3 items-end" th:action="@{/customer/dashboard}" method="get">
                    <div class="flex flex-col gap-2">
                        <label class="text-xs uppercase tracking-[0.2em] text-ink/60" for="accountId">Restaurant</label>
                        <select class="input" id="accountId" name="accountId" data-auto-submit>
                            <option th:each="acc : ${accounts}"
                                    th:value="${acc.id}"
                                    th:selected="${acc.id == accountId}"
                                    th:text="${acc.restaurant.name}">
                                ACCT
                            </option>
                        </select>
                    </div>
                </form>
            </div>
        </div>

        <div class="card p-6 flex flex-col gap-4 justify-between reveal">
            <div>
                <div class="text-sm uppercase tracking-[0.2em] text-ink/60">Current Points</div>
                <div class="points-big" th:text="${account != null ? account.currentPoints : 0}">0</div>
            </div>
            <div class="flex flex-wrap gap-2">
                <span class="stat-pill" th:text="${account != null ? account.status : 'N/A'}">N/A</span>
                <span class="stat-pill" th:text="${account != null ? account.tier : 'N/A'}">N/A</span>
            </div>
        </div>
    </div>

    <div th:if="${errorMessage != null}" class="card p-4 border border-red-200 bg-red-50 text-red-900 reveal">
        <div class="font-semibold">Error</div>
        <div class="text-sm" th:text="${errorMessage}">Message</div>
    </div>

    <div class="grid gap-6 lg:grid-cols-[1fr,1fr]">
        <div class="card p-6 reveal">
            <div class="text-sm uppercase tracking-[0.2em] text-ink/60">Account Details</div>
            <div class="mt-4 space-y-2 text-sm">
                <div class="flex justify-between border-b border-ink/10 py-2">
                    <span>Restaurant</span>
                    <span th:text="${account != null ? account.restaurantName : '-'}">-</span>
                </div>
                <div class="flex justify-between border-b border-ink/10 py-2">
                    <span>Customer Id</span>
                    <span th:text="${account != null ? account.customerId : '-'}">-</span>
                </div>
                <div class="flex justify-between border-b border-ink/10 py-2">
                    <span>Account Number</span>
                    <span th:text="${account != null ? account.accountNumber : '-'}">-</span>
                </div>
                <div class="flex justify-between border-b border-ink/10 py-2">
                    <span>Created</span>
                    <span th:text="${account != null ? account.createdAt : '-'}">-</span>
                </div>
            </div>
        </div>

        <div class="card p-6 reveal">
            <div class="text-sm uppercase tracking-[0.2em] text-ink/60">Latest Ledger Entries</div>
            <div class="mt-4 space-y-3" th:if="${account != null and account.ledgerEntries != null}">
                <div class="ledger-row" th:each="entry, iter : ${account.ledgerEntries}" th:if="${iter.index < 6}">
                    <div class="flex items-center justify-between">
                        <div class="font-semibold" th:text="${entry.entryType}">EARN</div>
                        <div class="text-sm text-ink/60" th:text="${entry.occurredAt}">-</div>
                    </div>
                    <div class="flex items-center justify-between text-sm">
                        <span th:text="${entry.description}">Description</span>
                        <span th:text="${entry.points}">0</span>
                    </div>
                    <div class="text-xs text-ink/60">Balance after: <span th:text="${entry.balanceAfter}">0</span></div>
                </div>
            </div>
            <div class="mt-4 text-sm text-ink/60" th:if="${account == null or account.ledgerEntries == null}">
                No ledger entries loaded.
            </div>
        </div>
    </div>
</section>
</html>
